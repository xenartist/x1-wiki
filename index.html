<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X1.Wiki - Top 100 Projects on X1 Blockchain</title>
    <script src="https://unpkg.com/@solana/web3.js@1.87.0/lib/index.iife.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            /* Dark Mode Color Palette - Consistent with MEMO Page */
            --bg-primary: #0b0f19;
            --bg-secondary: #111827;
            --bg-tertiary: #1e293b;
            --bg-card: #151c2c;
            --bg-hover: rgba(59, 130, 246, 0.1);
            --bg-input: #1e293b;
            
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            
            --accent-primary: #3b82f6;
            --accent-blue: #3b82f6;
            --accent-cyan: #06b6d4;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --accent-info: #06b6d4;
            
            --border-primary: #1e293b;
            --border-secondary: #334155;
            --border-light: #374151;
            --border-color: #1e293b;
            
            --shadow-light: 0 2px 4px rgba(0, 0, 0, 0.4);
            --shadow-medium: 0 4px 6px rgba(0, 0, 0, 0.5);
            --shadow-heavy: 0 20px 25px rgba(0, 0, 0, 0.6);
            
            --tooltip-bg: rgba(17, 24, 39, 0.95);
            
            --alert-error-bg: rgba(239, 68, 68, 0.15);
            --alert-error-border: rgba(239, 68, 68, 0.3);
            --alert-error-text: #fca5a5;
            
            --alert-warning-bg: rgba(245, 158, 11, 0.15);
            --alert-warning-border: rgba(245, 158, 11, 0.3);
            --alert-warning-text: #fbbf24;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Project Page Styles - Consistent with Reference Design */
        .project-page {
            min-height: 100vh;
            padding: 2rem;
            color: var(--text-primary);
        }

        .leaderboard-view {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header Section */
        .project-header {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border-primary);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        /* Navigation Links */
        .nav-links {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .nav-link {
            padding: 0.6rem 1.2rem;
            background: transparent;
            color: var(--text-secondary);
            text-decoration: none;
            border: 1px solid var(--border-secondary);
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
            cursor: pointer;
        }

        .nav-link:hover {
            color: var(--accent-blue);
            background: var(--bg-hover);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .nav-link:active {
            transform: translateY(0);
        }

        .header-text h1 {
            color: var(--text-primary);
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0 0 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }


        .project-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin: 0;
            font-weight: 500;
        }

        .header-actions {
            flex-shrink: 0;
        }

        /* Loading, Error, Empty States */
        .loading-state,
        .error-state,
        .empty-state {
            padding: 4rem 2rem;
            text-align: center;
            color: var(--text-secondary);
        }

        .loading-state {
            color: var(--accent-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 500;
        }

        .loading-state:before {
            content: "";
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-state {
            color: var(--alert-error-text);
            background: var(--alert-error-bg);
            border: 1px solid var(--alert-error-border);
            border-radius: 12px;
            margin: 2rem;
        }

        .error-state:before {
            content: "⚠️";
            font-size: 2rem;
            display: block;
            margin-bottom: 1rem;
        }

        /* Main Content Container */
        .project-content {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border-primary);
        }

        /* Table Container */
        .project-table-container {
            overflow-x: auto;
        }

        /* Table Styles */
        .project-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .project-table th {
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-weight: 600;
            padding: 18px 20px;
            text-align: left;
            border-bottom: 2px solid var(--border-primary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .project-table th:first-child {
            border-top-left-radius: 0;
        }

        .project-table th:last-child {
            border-top-right-radius: 0;
        }

        .project-table td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-light);
            vertical-align: middle;
        }

        .project-row {
            transition: all 0.3s ease;
            background: var(--bg-card);
        }

        .project-row:hover {
            background: var(--bg-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-light);
        }

        /* Cell-specific styles */
        .rank-cell {
            width: 60px;
        }

        .rank-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            min-width: 50px;
            background: transparent;
            border: 1px solid transparent;
        }

        .rank-icon i {
            font-size: 16px;
        }

        .rank-number {
            font-size: 13px;
            font-weight: 700;
        }

        .rank-1st {
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.3);
        }

        .rank-1st i {
            color: #f59e0b;
        }

        .rank-2nd {
            color: #9ca3af;
            background: rgba(156, 163, 175, 0.1);
            border-color: rgba(156, 163, 175, 0.3);
        }

        .rank-2nd i {
            color: #9ca3af;
        }

        .rank-3rd {
            color: #cd7c2f;
            background: rgba(205, 124, 47, 0.1);
            border-color: rgba(205, 124, 47, 0.3);
        }

        .rank-3rd i {
            color: #cd7c2f;
        }

        .rank-top10 {
            color: #dc2626;
            background: rgba(220, 38, 38, 0.1);
            border-color: rgba(220, 38, 38, 0.3);
        }

        .rank-top10 i {
            color: #dc2626;
        }

        .rank-others {
            color: #6b7280;
            background: rgba(107, 114, 128, 0.1);
            border-color: rgba(107, 114, 128, 0.3);
        }

        .rank-others i {
            color: #6b7280;
        }

        /* Hover effects */
        .rank-icon:hover {
            transform: scale(1.05);
            transition: all 0.2s ease;
        }

        .rank-1st:hover {
            background: rgba(245, 158, 11, 0.2);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }

        .rank-2nd:hover {
            background: rgba(156, 163, 175, 0.2);
            box-shadow: 0 2px 8px rgba(156, 163, 175, 0.3);
        }

        .rank-3rd:hover {
            background: rgba(205, 124, 47, 0.2);
            box-shadow: 0 2px 8px rgba(205, 124, 47, 0.3);
        }

        .rank-top10:hover {
            background: rgba(220, 38, 38, 0.2);
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
        }

        .rank-others:hover {
            background: rgba(107, 114, 128, 0.2);
            box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3);
        }

        .id-cell {
            width: 60px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
        }

        .logo-cell {
            width: 50px;
            text-align: center;
            padding: 8px;
        }

        .name-cell {
            min-width: 200px;
        }

        .project-name-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .project-logo {
            width: 32px;
            height: 32px;
            border-radius: 6px; /* Slightly rounded for pixel art */
            object-fit: cover;
            border: 1px solid var(--border-primary);
            background: var(--bg-secondary);
            image-rendering: pixelated; /* Keep pixel art crisp */
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .project-logo-placeholder {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 14px;
        }

        .project-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 15px;
        }

        .description-cell {
            min-width: 350px;
            max-width: 500px;
        }

        .project-description {
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .website-cell {
            min-width: 200px;
            max-width: 250px;
        }

        .website-link {
            color: var(--accent-blue);
            text-decoration: none;
            font-weight: 500;
            word-break: break-all;
            font-size: 13px;
            padding: 4px 8px;
            background: rgba(59, 130, 246, 0.15);
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .website-link:hover {
            background: rgba(59, 130, 246, 0.25);
            text-decoration: none;
        }

        .no-website {
            color: #9ca3af;
            font-style: italic;
        }

        .burned-cell {
            width: 110px;
            text-align: right;
            vertical-align: middle;
        }

        .burned-amount {
            font-weight: 500;
            color: #6b7280;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .burned-amount i {
            color: #6b7280;
            font-size: 13px;
            opacity: 1;
            margin-right: 6px;
        }

        .burned-fire-icon {
            margin-right: 8px;
        }

        /* Refresh Button */
        .refresh-btn {
            background: var(--bg-card);
            color: var(--accent-primary);
            border: 2px solid var(--accent-primary);
            border-radius: 12px;
            padding: 16px 32px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            margin: 0 0 2rem 0;
        }

        .refresh-btn:hover:not(:disabled) {
            background: var(--accent-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .refresh-btn:disabled {
            background: var(--bg-secondary);
            color: var(--text-muted);
            border-color: var(--border-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px 0;
            border-top: 1px solid var(--border-primary);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .footer a {
            color: var(--accent-primary);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .project-page {
                padding: 1rem;
            }
            
            .project-header {
                padding: 1.5rem;
            }
            
            .header-content {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }

            .nav-links {
                justify-content: center;
                gap: 0.5rem;
            }

            .nav-link {
                padding: 0.5rem 0.8rem;
                font-size: 0.85rem;
            }
            
            .header-text h1 {
                font-size: 2rem;
                text-align: center;
            }
            
            .project-table {
                font-size: 12px;
            }
            
            .project-table th,
            .project-table td {
                padding: 12px 10px;
            }
            
            /* Hide less important columns on mobile */
            .website-cell {
                display: none;
            }
        }

        /* ==========================
           Featured Activity Carousel Styles
           ========================== */

        .featured-carousel {
            margin-bottom: 2rem;
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border-primary);
            box-shadow: var(--shadow-medium);
        }

        .featured-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 1.5rem;
        }

        .featured-header i {
            color: var(--accent-warning);
            font-size: 1.5rem;
        }

        .featured-header h2 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }

        .carousel-container {
            position: relative;
            min-height: 320px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .carousel-track {
            position: relative;
            width: 100%;
            height: 300px;
            perspective: 1200px;
        }

        .featured-card {
            position: absolute;
            width: 100%;
            max-width: 800px;
            left: 50%;
            top: 50%;
            transform-origin: center center;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            box-shadow: var(--shadow-medium);
            overflow: hidden;
        }

        .featured-card-front {
            transform: translate(-50%, -50%) scale(1) translateZ(0);
            z-index: 3;
            opacity: 1;
        }

        .featured-card-back {
            transform: translate(-50%, -50%) scale(0.9) translateZ(-100px) translateX(-30%);
            z-index: 1;
            opacity: 0.4;
            filter: blur(2px);
            cursor: pointer;
        }

        .featured-card-back:hover {
            opacity: 0.6;
            filter: blur(1px);
            transform: translate(-50%, -50%) scale(0.92) translateZ(-80px) translateX(-28%);
        }

        .featured-card-next {
            transform: translate(-50%, -50%) scale(0.9) translateZ(-100px) translateX(30%);
            z-index: 1;
            opacity: 0.4;
            filter: blur(2px);
            cursor: pointer;
        }

        .featured-card-next:hover {
            opacity: 0.6;
            filter: blur(1px);
            transform: translate(-50%, -50%) scale(0.92) translateZ(-80px) translateX(28%);
        }

        .featured-card-content {
            padding: 2rem;
            min-height: 280px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Different background gradients for each operation type */
        .featured-create {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(6, 182, 212, 0.08) 100%);
        }

        .featured-update {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.08) 0%, rgba(236, 72, 153, 0.08) 100%);
        }

        .featured-burn {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.08) 0%, rgba(239, 68, 68, 0.08) 100%);
        }

        .featured-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            width: fit-content;
        }

        .create-badge {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.75) 0%, rgba(6, 182, 212, 0.75) 100%);
            color: white;
        }

        .update-badge {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.75) 0%, rgba(236, 72, 153, 0.75) 100%);
            color: white;
        }

        .burn-badge {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.75) 0%, rgba(239, 68, 68, 0.75) 100%);
            color: white;
        }

        .featured-project-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .featured-project-header {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .featured-logo,
        .featured-logo-placeholder {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            flex-shrink: 0;
            overflow: hidden;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .featured-logo-placeholder {
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border-primary);
        }

        .featured-logo-placeholder i {
            color: var(--text-muted);
            font-size: 1.2rem;
        }

        .featured-project-meta {
            flex: 1;
            min-width: 0;
        }

        .featured-project-name {
            color: var(--text-primary);
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0 0 4px 0;
            word-break: break-word;
        }

        .featured-project-id {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .featured-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
            margin: 0;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .featured-website {
            color: var(--accent-cyan);
            font-size: 0.9rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: color 0.2s;
        }

        .featured-website:hover {
            color: var(--accent-blue);
            text-decoration: underline;
        }

        .featured-stats {
            display: flex;
            gap: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-primary);
            flex-wrap: wrap;
        }

        .featured-stat {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .featured-stat i {
            color: var(--accent-warning);
            font-size: 1rem;
        }

        .featured-stat .stat-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .featured-stat .stat-label {
            color: var(--text-muted);
        }

        .featured-message {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
            margin: 0;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border-left: 3px solid var(--accent-warning);
        }

        /* Devlog specific styles */
        .devlog-layout-horizontal {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .devlog-content-wrapper {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .devlog-image {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
            object-fit: cover;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            border: 1px solid var(--border-primary);
        }

        .devlog-content {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
            margin: 0;
            white-space: pre-line;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Carousel indicators */
        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 1rem;
        }

        .indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            transition: all 0.3s;
            cursor: pointer;
        }

        .indicator:hover {
            background: var(--accent-cyan);
            opacity: 0.6;
            transform: scale(1.2);
        }

        .indicator.active {
            width: 24px;
            border-radius: 4px;
            background: var(--accent-cyan);
            border-color: var(--accent-cyan);
            cursor: default;
        }

        .indicator.active:hover {
            opacity: 1;
            transform: scale(1);
        }

        @media (max-width: 480px) {
            .project-table th,
            .project-table td {
                padding: 8px 6px;
            }
            
            .id-cell {
                display: none;
            }

            /* Featured carousel mobile styles */
            .featured-carousel {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .featured-header h2 {
                font-size: 1.2rem;
            }
            
            .carousel-track {
                height: 350px;
            }
            
            .featured-card {
                max-width: 100%;
            }
            
            .featured-card-back,
            .featured-card-next {
                transform: translate(-50%, -50%) scale(0.85) translateZ(-50px) translateX(0);
                opacity: 0;
                pointer-events: none;
            }
            
            .featured-card-content {
                padding: 1.5rem;
                min-height: 320px;
            }
            
            .featured-project-name {
                font-size: 1.1rem;
            }
            
            .featured-stats {
                gap: 1rem;
            }
            
            .featured-stat {
                font-size: 0.85rem;
            }

            /* Mobile devlog layout - stack vertically on small screens */
            .devlog-layout-horizontal {
                flex-direction: column;
            }
            
            .devlog-image {
                width: 80px;
                height: 80px;
            }
            
            .devlog-content {
                font-size: 0.85rem;
                -webkit-line-clamp: 4;
            }
        }
    </style>
</head>
<body>
    <div class="project-page">
        <div class="leaderboard-view">
            <!-- Header Section -->
            <div class="project-header">
                <div class="header-content">
                    <div class="header-text">
                        <h1>
                            <i class="fas fa-trophy"></i>
                            X1.Wiki
                        </h1>
                        <p class="project-subtitle">Top 100 Projects on X1 Blockchain</p>
                    </div>
                    <div class="nav-links">
                        <a href="https://validator.x1.wiki/" target="_blank" rel="noopener noreferrer" class="nav-link">
                            <i class="fas fa-server"></i> Validator
                        </a>
                        <a href="https://memo.rip/" target="_blank" rel="noopener noreferrer" class="nav-link">
                            <i class="fas fa-sticky-note"></i> MEMO
                        </a>
                        <a href="https://xoon.dev/" target="_blank" rel="noopener noreferrer" class="nav-link">
                            <i class="fas fa-rocket"></i> XOON
                        </a>
                        <a href="https://thesecond.best/" target="_blank" rel="noopener noreferrer" class="nav-link">
                            <i class="fas fa-medal"></i> The Second Best
                        </a>
                    </div>
                </div>
            </div>

            <!-- Featured Activity Carousel -->
            <div class="featured-carousel">
                <div class="featured-header">
                    <i class="fas fa-star"></i>
                    <h2>Featured Activity</h2>
                </div>
                <div class="carousel-container">
                    <div id="carouselTrack" class="carousel-track">
                        <!-- Featured cards will be dynamically inserted here -->
                    </div>
                    <div id="carouselIndicators" class="carousel-indicators">
                        <!-- Indicators will be dynamically inserted here -->
                    </div>
                </div>
            </div>
            
            <button class="refresh-btn" id="refreshBtn" onclick="loadLeaderboard()">
                <i class="fas fa-sync-alt"></i>
                Refresh Data
            </button>
            
            <!-- Main Content -->
            <div class="project-content">
                <div id="loadingMessage" class="loading-state">
                    Loading projects from X1 mainnet...
                </div>

                <div id="errorMessage" class="error-state" style="display: none;"></div>

                <div id="leaderboardTable" class="project-table-container" style="display: none;">
                    <table class="project-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>ID</th>
                                <th>Logo</th>
                                <th>Name</th>
                                <th>Website</th>
                                <th>Description</th>
                                <th>Burned</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p><strong>Create your own project on <a href="https://memo.rip">https://memo.rip</a></strong></p>
            <p><a href="https://x1.wiki">x1.wiki</a> is maintained by <a href="https://x.com/xen_artist">@xen_artist</a></p>
        </div>
    </div>

    <script>
        const RPC_URL = 'https://rpc.mainnet.x1.xyz';
        const MEMO_PROJECT_PROGRAM_ID = '6Vavot6ybhWBG3rjNXnLfNRPVTz7Garf6E4EZk3byp3a';

        let connection;

        // Initialize connection
        function initConnection() {
            connection = new solanaWeb3.Connection(RPC_URL, 'confirmed');
        }

        // Calculate PDA (Program Derived Address)
        function calculatePDA(seeds, programId) {
            return solanaWeb3.PublicKey.findProgramAddressSync(seeds, new solanaWeb3.PublicKey(programId));
        }

        // Parse leaderboard data according to Rust BurnLeaderboard structure
        function parseLeaderboardData(data) {
            if (data.length < 12) { // 8 bytes discriminator + 4 bytes vec length minimum
                throw new Error('Data too short for leaderboard structure');
            }

            let offset = 8; // Skip discriminator

            // Read Vec<LeaderboardEntry> length (u32)
            const vecLength = new DataView(data.buffer, offset, 4).getUint32(0, true);
            offset += 4;

            console.log(`Leaderboard contains ${vecLength} entries`);

            // Verify we have enough data for all entries
            const expectedDataLength = offset + (vecLength * 16); // Each entry is 16 bytes (u64 + u64)
            if (data.length < expectedDataLength) {
                throw new Error(`Data too short: expected ${expectedDataLength} bytes, got ${data.length} bytes`);
            }

            // Read entries
            const entries = [];
            for (let i = 0; i < vecLength; i++) {
                const entryOffset = offset + (i * 16);
                
                // Read project_id (u64)
                const projectId = new DataView(data.buffer, entryOffset, 8).getBigUint64(0, true);
                // Read burned_amount (u64) 
                const burnedAmount = new DataView(data.buffer, entryOffset + 8, 8).getBigUint64(0, true);

                entries.push({
                    projectId: Number(projectId),
                    burnedAmount: burnedAmount
                });
            }

            console.log(`Parsed ${entries.length} leaderboard entries`);

            return {
                entries
            };
        }

        // Parse project data according to Rust contract structure
        function parseProjectData(data) {
            if (data.length < 8) {
                throw new Error('Data too short');
            }

            let offset = 8; // Skip discriminator

            // Read project_id (u64 - 8 bytes)
            const projectId = new DataView(data.buffer, offset, 8).getBigUint64(0, true);
            offset += 8;

            // Read creator (Pubkey - 32 bytes)
            const creator = new solanaWeb3.PublicKey(data.slice(offset, offset + 32));
            offset += 32;

            // Read created_at (i64 - 8 bytes)
            const createdAt = new DataView(data.buffer, offset, 8).getBigInt64(0, true);
            offset += 8;

            // Read last_updated (i64 - 8 bytes)
            const lastUpdated = new DataView(data.buffer, offset, 8).getBigInt64(0, true);
            offset += 8;

            // Read name string
            const nameLength = new DataView(data.buffer, offset, 4).getUint32(0, true);
            offset += 4;
            const name = new TextDecoder().decode(data.slice(offset, offset + nameLength));
            offset += nameLength;

            // Read description string
            const descLength = new DataView(data.buffer, offset, 4).getUint32(0, true);
            offset += 4;
            const description = new TextDecoder().decode(data.slice(offset, offset + descLength));
            offset += descLength;

            // Read image string (but skip content for now)
            const imageLength = new DataView(data.buffer, offset, 4).getUint32(0, true);
            offset += 4;
            const image = new TextDecoder().decode(data.slice(offset, offset + imageLength));
            offset += imageLength;

            // Read website string
            const websiteLength = new DataView(data.buffer, offset, 4).getUint32(0, true);
            offset += 4;
            const website = new TextDecoder().decode(data.slice(offset, offset + websiteLength));
            offset += websiteLength;

            // Read tags vector
            const tagsVecLength = new DataView(data.buffer, offset, 4).getUint32(0, true);
            offset += 4;
            const tags = [];
            for (let i = 0; i < tagsVecLength; i++) {
                const tagLength = new DataView(data.buffer, offset, 4).getUint32(0, true);
                offset += 4;
                const tag = new TextDecoder().decode(data.slice(offset, offset + tagLength));
                offset += tagLength;
                tags.push(tag);
            }

            // Read memo_count (u64 - 8 bytes)
            const memoCount = new DataView(data.buffer, offset, 8).getBigUint64(0, true);
            offset += 8;

            // Read burned_amount (u64 - 8 bytes)
            const burnedAmount = new DataView(data.buffer, offset, 8).getBigUint64(0, true);
            offset += 8;

            // Read last_memo_time (i64 - 8 bytes)  
            const lastMemoTime = new DataView(data.buffer, offset, 8).getBigInt64(0, true);
            offset += 8;

            // Read bump (u8 - 1 byte)
            const bump = new DataView(data.buffer, offset, 1).getUint8(0);

            return {
                projectId: Number(projectId),
                creator,
                createdAt: Number(createdAt),
                lastUpdated: Number(lastUpdated),
                name,
                description,
                image,
                website,
                tags,
                memoCount: Number(memoCount),
                burnedAmount, // Keep as BigInt for precision
                lastMemoTime: Number(lastMemoTime),
                bump
            };
        }

        // ============================================
        // Featured Activity Functions
        // ============================================

        let currentCarouselIndex = 0;
        let featuredActivities = [];
        let carouselInterval = null;

        // Parse Borsh-serialized BurnMemo and operation data
        function parseFeaturedActivityMemo(memoData) {
            try {
                // Decode Base64
                const borshBytes = Uint8Array.from(atob(memoData), c => c.charCodeAt(0));
                
                let offset = 0;
                
                // Read BurnMemo version (u8)
                const version = borshBytes[offset];
                offset += 1;
                
                // Read burn_amount (u64)
                const burnAmountView = new DataView(borshBytes.buffer, borshBytes.byteOffset + offset, 8);
                const burnAmount = burnAmountView.getBigUint64(0, true);
                offset += 8;
                
                // Read payload length (u32)
                const payloadLenView = new DataView(borshBytes.buffer, borshBytes.byteOffset + offset, 4);
                const payloadLen = payloadLenView.getUint32(0, true);
                offset += 4;
                
                // Read payload
                const payload = borshBytes.slice(offset, offset + payloadLen);
                
                // Parse payload for project operation
                return parseProjectOperationPayload(payload, burnAmount);
            } catch (e) {
                console.error('Error parsing featured activity memo:', e);
                return null;
            }
        }

        function parseProjectOperationPayload(payload, burnAmount) {
            try {
                let offset = 0;
                
                // Read version (u8)
                const version = payload[offset];
                offset += 1;
                
                // Read category string (u32 len + bytes)
                const categoryLenView = new DataView(payload.buffer, payload.byteOffset + offset, 4);
                const categoryLen = categoryLenView.getUint32(0, true);
                offset += 4;
                const category = new TextDecoder().decode(payload.slice(offset, offset + categoryLen));
                offset += categoryLen;
                
                // Read operation string (u32 len + bytes)
                const operationLenView = new DataView(payload.buffer, payload.byteOffset + offset, 4);
                const operationLen = operationLenView.getUint32(0, true);
                offset += 4;
                const operation = new TextDecoder().decode(payload.slice(offset, offset + operationLen));
                offset += operationLen;
                
                if (category !== 'project') {
                    return null;
                }
                
                // Read project_id (u64)
                const projectIdView = new DataView(payload.buffer, payload.byteOffset + offset, 8);
                const projectId = projectIdView.getBigUint64(0, true);
                offset += 8;
                
                let details = { projectId: Number(projectId) };
                
                if (operation === 'create_project') {
                    // Read name
                    const nameLenView = new DataView(payload.buffer, payload.byteOffset + offset, 4);
                    const nameLen = nameLenView.getUint32(0, true);
                    offset += 4;
                    details.name = new TextDecoder().decode(payload.slice(offset, offset + nameLen));
                    offset += nameLen;
                    
                    // Read description
                    const descLenView = new DataView(payload.buffer, payload.byteOffset + offset, 4);
                    const descLen = descLenView.getUint32(0, true);
                    offset += 4;
                    details.description = new TextDecoder().decode(payload.slice(offset, offset + descLen));
                    offset += descLen;
                    
                    // Read image
                    const imageLenView = new DataView(payload.buffer, payload.byteOffset + offset, 4);
                    const imageLen = imageLenView.getUint32(0, true);
                    offset += 4;
                    details.image = new TextDecoder().decode(payload.slice(offset, offset + imageLen));
                    offset += imageLen;
                    
                    // Read website
                    const websiteLenView = new DataView(payload.buffer, payload.byteOffset + offset, 4);
                    const websiteLen = websiteLenView.getUint32(0, true);
                    offset += 4;
                    details.website = new TextDecoder().decode(payload.slice(offset, offset + websiteLen));
                    offset += websiteLen;
                    
                    return {
                        type: 'CreateProject',
                        burnAmount,
                        details
                    };
                } else if (operation === 'update_project') {
                    return {
                        type: 'UpdateProject',
                        burnAmount,
                        details
                    };
                } else if (operation === 'burn_for_project') {
                    // Read burner string
                    const burnerLenView = new DataView(payload.buffer, payload.byteOffset + offset, 4);
                    const burnerLen = burnerLenView.getUint32(0, true);
                    offset += 4;
                    details.burner = new TextDecoder().decode(payload.slice(offset, offset + burnerLen));
                    offset += burnerLen;
                    
                    // Read message
                    const messageLenView = new DataView(payload.buffer, payload.byteOffset + offset, 4);
                    const messageLen = messageLenView.getUint32(0, true);
                    offset += 4;
                    details.message = new TextDecoder().decode(payload.slice(offset, offset + messageLen));
                    offset += messageLen;
                    
                    console.log('Raw message content:', details.message);
                    console.log('Message length:', details.message.length, 'Expected:', messageLen);
                    
                    // Try to parse message as JSON for devlog format
                    let isDevlog = false;
                    try {
                        // Trim whitespace and check if it looks like JSON
                        let trimmedMessage = details.message.trim();
                        
                        // Handle control characters in JSON strings (like newlines in content)
                        // Replace actual newlines with \n escape sequences
                        trimmedMessage = trimmedMessage.replace(/\r?\n/g, '\\n').replace(/\t/g, '\\t');
                        
                        if (trimmedMessage.startsWith('{') && trimmedMessage.endsWith('}')) {
                            const messageJson = JSON.parse(trimmedMessage);
                            console.log('Parsed message JSON:', messageJson);
                            
                            if (messageJson.type === 'devlog' && messageJson.title) {
                                // This is a devlog
                                // Restore newlines in content for display
                                const content = (messageJson.content || '').replace(/\\n/g, '\n');
                                
                                details.devlog = {
                                    title: messageJson.title,
                                    content: content,
                                    image: messageJson.image || ''
                                };
                                isDevlog = true;
                                console.log('Detected devlog:', details.devlog);
                            }
                        } else {
                            console.log('Message is not JSON format (does not start with { and end with })');
                        }
                    } catch (e) {
                        // Not JSON or not devlog format, treat as regular message
                        console.error('Failed to parse message as JSON:', e);
                        console.log('Message preview:', details.message.substring(0, 200));
                    }
                    
                    return {
                        type: isDevlog ? 'DevlogActivity' : 'BurnForProject',
                        burnAmount,
                        details
                    };
                }
                
                return null;
            } catch (e) {
                console.error('Error parsing project operation payload:', e);
                return null;
            }
        }

        // Load featured activity (recent 3 transactions)
        async function loadFeaturedActivity() {
            try {
                const programId = new solanaWeb3.PublicKey(MEMO_PROJECT_PROGRAM_ID);
                
                // Get recent signatures for the program
                const signatures = await connection.getSignaturesForAddress(programId, {
                    limit: 3
                });
                
                console.log('Found', signatures.length, 'recent signatures');
                
                featuredActivities = [];
                
                for (const sigInfo of signatures) {
                    try {
                        const signature = sigInfo.signature;
                        const blockTime = sigInfo.blockTime;
                        const slot = sigInfo.slot;
                        const memo = sigInfo.memo;
                        
                        if (!memo) continue;
                        
                        // Parse memo (format: "[length] base64_data")
                        const memoData = memo.includes(' ') ? memo.split(' ')[1] : memo;
                        
                        // Parse the memo to get operation details
                        const parsed = parseFeaturedActivityMemo(memoData);
                        
                        if (!parsed) continue;
                        
                        // Get project info
                        const projectId = parsed.details.projectId;
                        let projectInfo = null;
                        
                        try {
                            const projectIdBytes = new ArrayBuffer(8);
                            const view = new DataView(projectIdBytes);
                            view.setBigUint64(0, BigInt(projectId), true);
                            
                            const [projectPDA] = calculatePDA(
                                [new TextEncoder().encode('project'), new Uint8Array(projectIdBytes)],
                                MEMO_PROJECT_PROGRAM_ID
                            );
                            
                            const projectAccount = await connection.getAccountInfo(projectPDA);
                            if (projectAccount) {
                                projectInfo = parseProjectData(projectAccount.data);
                            }
                        } catch (e) {
                            console.warn('Failed to get project info for ID', projectId, e);
                        }
                        
                        featuredActivities.push({
                            signature,
                            blockTime,
                            slot,
                            type: parsed.type,
                            burnAmount: parsed.burnAmount,
                            details: parsed.details,
                            projectInfo
                        });
                    } catch (e) {
                        console.error('Error processing signature:', e);
                    }
                }
                
                console.log('Parsed featured activities:', featuredActivities);
                
                if (featuredActivities.length > 0) {
                    renderFeaturedCarousel();
                    startCarousel();
                }
            } catch (error) {
                console.error('Error loading featured activity:', error);
            }
        }

        // Render featured carousel
        function renderFeaturedCarousel() {
            const carouselTrack = document.getElementById('carouselTrack');
            const carouselIndicators = document.getElementById('carouselIndicators');
            
            if (!carouselTrack || !carouselIndicators) return;
            
            // Clear existing content
            carouselTrack.innerHTML = '';
            carouselIndicators.innerHTML = '';
            
            // Render each activity card
            featuredActivities.forEach((activity, index) => {
                const card = createFeaturedCard(activity, index);
                carouselTrack.appendChild(card);
                
                // Create indicator
                const indicator = document.createElement('div');
                indicator.className = 'indicator' + (index === 0 ? ' active' : '');
                indicator.addEventListener('click', () => goToSlide(index));
                carouselIndicators.appendChild(indicator);
            });
            
            updateCarouselPositions();
        }

        // Create a featured card
        function createFeaturedCard(activity, index) {
            const card = document.createElement('div');
            card.className = 'featured-card';
            card.dataset.index = index;
            
            const isDevlog = activity.type === 'DevlogActivity';
            
            const typeClass = activity.type === 'CreateProject' ? 'featured-create' :
                            activity.type === 'UpdateProject' ? 'featured-update' : 'featured-burn';
            
            const badgeClass = activity.type === 'CreateProject' ? 'create-badge' :
                             activity.type === 'UpdateProject' ? 'update-badge' : 'burn-badge';
            
            const badgeText = activity.type === 'CreateProject' ? 'Create Project' :
                            activity.type === 'UpdateProject' ? 'Update Project' : 'Devlog Activity';
            
            const badgeIcon = activity.type === 'CreateProject' ? 'fa-plus-circle' :
                            activity.type === 'UpdateProject' ? 'fa-edit' : 'fa-fire';
            
            let logoHtml = '';
            if (activity.projectInfo && activity.projectInfo.image) {
                const image = activity.projectInfo.image;
                if (image.startsWith('n:') || image.startsWith('c:')) {
                    try {
                        const pixelData = PixelArt.fromOptimalString(image);
                        if (pixelData) {
                            const dataUrl = PixelArt.renderToCanvas(pixelData, 48);
                            if (dataUrl) {
                                logoHtml = `<img src="${dataUrl}" alt="Logo" class="featured-logo">`;
                            }
                        } else {
                            console.warn('Pixel art parsing failed for project logo');
                        }
                    } catch (e) {
                        console.error('Error rendering pixel art:', e);
                    }
                }
                if (!logoHtml && image) {
                    logoHtml = `<img src="${image}" alt="Logo" class="featured-logo" onerror="this.style.display='none';">`;
                }
            }
            if (!logoHtml) {
                logoHtml = `<div class="featured-logo-placeholder"><i class="fas fa-cube"></i></div>`;
            }
            
            const projectName = activity.projectInfo ? (activity.projectInfo.name || `Project ${activity.details.projectId}`) : `Project ${activity.details.projectId}`;
            const projectDescription = activity.projectInfo ? activity.projectInfo.description : '';
            const projectWebsite = activity.projectInfo ? activity.projectInfo.website : '';
            
            const burnedTokens = (Number(activity.burnAmount) / 1_000_000).toFixed(0);
            const timeAgo = getTimeAgo(activity.blockTime);
            
            let contentHtml = '';
            
            if (activity.type === 'CreateProject') {
                contentHtml = `
                    <div class="featured-project-info">
                        <div class="featured-project-header">
                            ${logoHtml}
                            <div class="featured-project-meta">
                                <h3 class="featured-project-name">${projectName}</h3>
                                <p class="featured-project-id">Project #${activity.details.projectId}</p>
                            </div>
                        </div>
                        ${projectDescription ? `<p class="featured-description">${projectDescription}</p>` : ''}
                        ${projectWebsite ? `<a href="${projectWebsite}" target="_blank" class="featured-website" rel="noopener noreferrer">
                            <i class="fas fa-external-link-alt"></i> ${projectWebsite}
                        </a>` : ''}
                    </div>
                `;
            } else if (activity.type === 'UpdateProject') {
                contentHtml = `
                    <div class="featured-project-info">
                        <div class="featured-project-header">
                            ${logoHtml}
                            <div class="featured-project-meta">
                                <h3 class="featured-project-name">${projectName}</h3>
                                <p class="featured-project-id">Project #${activity.details.projectId}</p>
                            </div>
                        </div>
                        ${projectDescription ? `<p class="featured-description">${projectDescription}</p>` : ''}
                    </div>
                `;
            } else if (activity.type === 'DevlogActivity') {
                // Handle Devlog format with image
                const devlog = activity.details.devlog;
                
                // Safety check - ensure devlog exists
                if (!devlog) {
                    console.error('DevlogActivity type but no devlog data found');
                    contentHtml = `
                        <div class="featured-project-info">
                            <div class="featured-project-header">
                                ${logoHtml}
                                <div class="featured-project-meta">
                                    <h3 class="featured-project-name">${projectName}</h3>
                                    <p class="featured-project-id">Project #${activity.details.projectId}</p>
                                </div>
                            </div>
                            <p class="featured-message">Devlog data unavailable</p>
                        </div>
                    `;
                } else {
                    let devlogImageHtml = '';
                    
                    if (devlog.image) {
                        const devlogImage = devlog.image;
                        console.log('Processing devlog image:', devlogImage.substring(0, 50) + '...');
                        
                        if (devlogImage.startsWith('n:') || devlogImage.startsWith('c:')) {
                            try {
                                const pixelData = PixelArt.fromOptimalString(devlogImage);
                                if (pixelData) {
                                    const dataUrl = PixelArt.renderToCanvas(pixelData, 100);
                                    if (dataUrl) {
                                        devlogImageHtml = `<img src="${dataUrl}" alt="${escapeHtml(devlog.title)}" class="devlog-image">`;
                                        console.log('Successfully rendered devlog pixel art');
                                    }
                                } else {
                                    console.warn('Pixel art parsing failed for devlog');
                                }
                            } catch (e) {
                                console.error('Error rendering devlog pixel art:', e);
                            }
                        } else if (devlogImage) {
                            devlogImageHtml = `<img src="${devlogImage}" alt="${escapeHtml(devlog.title)}" class="devlog-image" onerror="this.style.display='none';">`;
                        }
                    }
                    
                    contentHtml = `
                        <div class="featured-project-info">
                            <div class="featured-project-header">
                                ${logoHtml}
                                <div class="featured-project-meta">
                                    <h3 class="featured-project-name">${escapeHtml(devlog.title)}</h3>
                                    <p class="featured-project-id">For project: ${projectName}</p>
                                </div>
                            </div>
                            <div class="devlog-layout-horizontal">
                                ${devlogImageHtml ? devlogImageHtml : ''}
                                <div class="devlog-content-wrapper">
                                    ${devlog.content ? `<p class="devlog-content">${escapeHtml(devlog.content)}</p>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }
            } else if (activity.type === 'BurnForProject') {
                contentHtml = `
                    <div class="featured-project-info">
                        <div class="featured-project-header">
                            ${logoHtml}
                            <div class="featured-project-meta">
                                <h3 class="featured-project-name">${projectName}</h3>
                                <p class="featured-project-id">Project #${activity.details.projectId}</p>
                            </div>
                        </div>
                        ${activity.details.message ? `<p class="featured-message">${activity.details.message}</p>` : ''}
                    </div>
                `;
            }
            
            card.innerHTML = `
                <div class="featured-card-content ${typeClass}">
                    <span class="featured-badge ${badgeClass}">
                        <i class="fas ${badgeIcon}"></i> ${badgeText}
                    </span>
                    ${contentHtml}
                    <div class="featured-stats">
                        <div class="featured-stat">
                            <i class="fas fa-fire"></i>
                            <span class="stat-value">${formatNumberWithCommas(burnedTokens)}</span>
                            <span class="stat-label">MEMO Burned</span>
                        </div>
                        <div class="featured-stat">
                            <i class="fas fa-clock"></i>
                            <span class="stat-value">${timeAgo}</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Add click handler for side cards
            card.addEventListener('click', () => {
                if (index !== currentCarouselIndex) {
                    goToSlide(index);
                }
            });
            
            return card;
        }

        // Update carousel positions
        function updateCarouselPositions() {
            const cards = document.querySelectorAll('.featured-card');
            const indicators = document.querySelectorAll('.indicator');
            
            cards.forEach((card, index) => {
                card.className = 'featured-card';
                
                if (index === currentCarouselIndex) {
                    card.classList.add('featured-card-front');
                } else if (index === (currentCarouselIndex + featuredActivities.length - 1) % featuredActivities.length) {
                    card.classList.add('featured-card-back');
                } else if (index === (currentCarouselIndex + 1) % featuredActivities.length) {
                    card.classList.add('featured-card-next');
                } else {
                    card.style.opacity = '0';
                    card.style.pointerEvents = 'none';
                }
            });
            
            indicators.forEach((indicator, index) => {
                if (index === currentCarouselIndex) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
        }

        // Go to specific slide
        function goToSlide(index) {
            currentCarouselIndex = index;
            updateCarouselPositions();
            resetCarousel();
        }

        // Start auto carousel
        function startCarousel() {
            if (featuredActivities.length <= 1) return;
            
            carouselInterval = setInterval(() => {
                currentCarouselIndex = (currentCarouselIndex + 1) % featuredActivities.length;
                updateCarouselPositions();
            }, 5000); // Change every 5 seconds
        }

        // Reset carousel timer
        function resetCarousel() {
            if (carouselInterval) {
                clearInterval(carouselInterval);
                startCarousel();
            }
        }

        // Get time ago string
        function getTimeAgo(timestamp) {
            const now = Math.floor(Date.now() / 1000);
            const diff = now - timestamp;
            
            if (diff < 60) return 'Just now';
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return `${Math.floor(diff / 86400)}d ago`;
        }

        // Get rank display based on reference design
        function getRankDisplay(rank) {
            let rankClass = '';
            let icon = '';
            
            if (rank === 1) {
                rankClass = 'rank-1st';
                icon = '<i class="fas fa-trophy"></i>';
            } else if (rank === 2) {
                rankClass = 'rank-2nd';
                icon = '<i class="fas fa-medal"></i>';
            } else if (rank === 3) {
                rankClass = 'rank-3rd';
                icon = '<i class="fas fa-medal"></i>';
            } else if (rank >= 4 && rank <= 10) {
                rankClass = 'rank-top10';
                icon = '<i class="fas fa-fire"></i>';
            } else {
                rankClass = 'rank-others';
                icon = '<i class="fas fa-fire"></i>';
            }
            
            return {
                class: rankClass,
                html: `<span class="rank-icon ${rankClass}">${icon}<span class="rank-number">${rank}</span></span>`
            };
        }

        // Escape HTML to prevent XSS and display issues
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Format number with commas (from reference)
        function formatNumberWithCommas(num) {
            const numStr = num.toString();
            let result = '';
            const chars = numStr.split('');
            
            for (let i = 0; i < chars.length; i++) {
                if (i > 0 && (chars.length - i) % 3 === 0) {
                    result += ',';
                }
                result += chars[i];
            }
            
            return result;
        }

        // Pixel Art Decoder - matches Rust implementation
        const PixelArt = {
            // Map safe character back to 6-bit value (from Rust map_from_safe_char)
            mapFromSafeChar(c) {
                const ascii = c.charCodeAt(0);
                
                // Check special characters
                if (c === ':' || c === '\\' || c === '"') {
                    return null;
                }
                
                // Check range
                if (ascii < 35 || ascii > 126) {
                    return null;
                }
                
                let value = ascii - 35;
                if (ascii > 92) value -= 1;  // adjust for '\'
                if (ascii > 58) value -= 1;  // adjust for ':'
                
                if (value >= 64) {
                    return null;
                }
                
                return value;
            },

            // Decode from safe string with specified dimensions
            fromSafeStringWithSize(s, width, height) {
                const expectedPixels = width * height;
                const expectedChars = Math.ceil(expectedPixels / 6); // Round up division
                
                // Validate string length
                if (s.length < expectedChars || s.length > expectedChars + 1) {
                    console.log(`String length ${s.length} doesn't match expected ${expectedChars} for ${width}x${height}`);
                    return null;
                }
                
                const data = new Array(width * height).fill(false);
                let bitPos = 0;
                
                for (const c of s) {
                    const value = this.mapFromSafeChar(c);
                    if (value === null) {
                        console.log(`Failed to map char: '${c}'`);
                        return null;
                    }
                    
                    for (let i = 5; i >= 0; i--) {
                        if (bitPos >= expectedPixels) {
                            break;
                        }
                        
                        const bit = (value & (1 << i)) !== 0;
                        data[bitPos] = bit;
                        bitPos++;
                    }
                    
                    if (bitPos >= expectedPixels) {
                        break;
                    }
                }
                
                return {
                    width,
                    height,
                    data
                };
            },

            // Decompress Base64-encoded compressed pixel data using Deflate
            fromCompressedString(compressedData, width, height) {
                try {
                    // Decode Base64 to binary
                    const binaryString = atob(compressedData);
                    const bytes = new Uint8Array(binaryString.length);
                    for (let i = 0; i < binaryString.length; i++) {
                        bytes[i] = binaryString.charCodeAt(i);
                    }
                    
                    console.log('Compressed data length:', bytes.length);
                    
                    // Decompress using pako (Deflate decompression)
                    let decompressed;
                    try {
                        decompressed = pako.inflateRaw(bytes);
                        console.log('Decompressed data length:', decompressed.length);
                    } catch (e) {
                        console.error('Deflate decompression failed:', e);
                        return null;
                    }
                    
                    // Convert decompressed bytes to string (keeping original ASCII values)
                    const decompressedStr = Array.from(decompressed)
                        .map(b => String.fromCharCode(b))
                        .join('');
                    
                    console.log('Decompressed string length:', decompressedStr.length);
                    console.log('Decompressed string preview:', decompressedStr.substring(0, 50));
                    
                    // Now decode the decompressed string using normal safe string decoding
                    return this.fromSafeStringWithSize(decompressedStr, width, height);
                } catch (e) {
                    console.error('Error decompressing pixel art:', e);
                    return null;
                }
            },

            // Decode from optimal string format (matches Rust from_optimal_string)
            fromOptimalString(s) {
                if (s.length < 2) {
                    return null;
                }

                const parts = s.split(':');
                
                if (parts.length === 3) {
                    // New format: type:widthxheight:data
                    const formatType = parts[0];
                    const sizeStr = parts[1];
                    const data = parts[2];
                    
                    // Parse size: "32x32" -> [32, 32]
                    const sizeParts = sizeStr.split('x');
                    if (sizeParts.length !== 2) {
                        return null;
                    }
                    
                    const width = parseInt(sizeParts[0]);
                    const height = parseInt(sizeParts[1]);
                    
                    if (isNaN(width) || isNaN(height)) {
                        return null;
                    }
                    
                    // Process data based on format type
                    switch (formatType) {
                        case 'c':
                            // Compressed format: decompress the data
                            return this.fromCompressedString(data, width, height);
                        case 'n':
                            return this.fromSafeStringWithSize(data, width, height);
                        default:
                            return null;
                    }
                } else if (parts.length === 2) {
                    // Old format for backward compatibility: type:data
                    const [prefix, data] = parts;
                    
                    switch (prefix) {
                        case 'c':
                            // Compressed format without size - not supported in old format
                            console.log('Compressed format requires size specification (use c:32x32:data format)');
                            return null;
                        case 'n':
                            // Try to detect size from data length
                            return this.fromSafeStringAutoSize(data);
                        default:
                            return null;
                    }
                }
                
                return null;
            },

            // Auto-detect size from string length (matches Rust logic)
            fromSafeStringAutoSize(s) {
                const totalBits = s.length * 6;
                console.log(`Input string length: ${s.length}, total_bits: ${totalBits}`);
                
                let size;
                switch (true) {
                    case (totalBits >= 60 && totalBits <= 72):   // 8x8
                        size = [8, 8];
                        break;
                    case (totalBits >= 252 && totalBits <= 264): // 16x16
                        size = [16, 16];
                        break;
                    case (totalBits >= 1020 && totalBits <= 1032): // 32x32
                        size = [32, 32];
                        break;
                    case (totalBits >= 4092 && totalBits <= 4104): // 64x64
                        size = [64, 64];
                        break;
                    default:
                        console.log(`Unexpected total bits: ${totalBits}`);
                        return null;
                }
                
                console.log(`Detected size: ${size[0]}x${size[1]}`);
                return this.fromSafeStringWithSize(s, size[0], size[1]);
            },

            // Render pixel art to canvas
            renderToCanvas(pixelData, size = 32) {
                if (!pixelData) return null;
                
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                
                // Set background to white
                ctx.fillStyle = '#ffffff'; // White background
                ctx.fillRect(0, 0, size, size);
                
                const pixelSize = size / pixelData.width;
                
                // Draw pixels in black
                ctx.fillStyle = '#000000'; // Black pixels
                for (let y = 0; y < pixelData.height; y++) {
                    for (let x = 0; x < pixelData.width; x++) {
                        const pixel = pixelData.data[y * pixelData.width + x];
                        if (pixel) {
                            ctx.fillRect(
                                Math.floor(x * pixelSize), 
                                Math.floor(y * pixelSize), 
                                Math.ceil(pixelSize), 
                                Math.ceil(pixelSize)
                            );
                        }
                    }
                }
                
                return canvas.toDataURL();
            }
        };

        // Render project logo (handles both pixel art and regular images)
        function renderProjectLogo(project) {
            const imageData = project.image && project.image.trim();
            const altText = project.name || `Project ${project.projectId}`;
            
            if (!imageData) {
                return '<div class="project-logo-placeholder"><i class="fas fa-cube"></i></div>';
            }
            
            // Check if it's pixel art data (starts with format prefix)
            if (imageData.startsWith('n:') || imageData.startsWith('c:')) {
                try {
                    const pixelData = PixelArt.fromOptimalString(imageData);
                    if (pixelData) {
                        const dataUrl = PixelArt.renderToCanvas(pixelData, 32);
                        if (dataUrl) {
                            return `<img src="${dataUrl}" alt="${altText}" class="project-logo">` +
                                   '<div class="project-logo-placeholder" style="display:none;"><i class="fas fa-cube"></i></div>';
                        }
                    }
                } catch (error) {
                    console.log(`Failed to render pixel art for project ${project.projectId}:`, error);
                }
                
                // Fallback for pixel art decode errors
                return '<div class="project-logo-placeholder"><i class="fas fa-image"></i></div>';
            }
            
            // Handle regular image URLs
            if (imageData.startsWith('http://') || imageData.startsWith('https://') || imageData.startsWith('data:')) {
                return `<img src="${imageData}" alt="${altText}" class="project-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` +
                       '<div class="project-logo-placeholder" style="display:none;"><i class="fas fa-cube"></i></div>';
            }
            
            // Fallback for unknown format
            return '<div class="project-logo-placeholder"><i class="fas fa-question"></i></div>';
        }

        // Truncate description (from reference)
        function truncateDescription(description) {
            if (!description || description === '') {
                return '-';
            }
            
            const bytes = new TextEncoder().encode(description);
            if (bytes.length <= 128) {
                return description;
            } else {
                // Find the last complete UTF-8 character boundary within 128 bytes
                let end = 128;
                const decoder = new TextDecoder('utf-8', { fatal: false });
                
                while (end > 0) {
                    try {
                        const truncated = decoder.decode(bytes.slice(0, end));
                        if (!truncated.endsWith('\uFFFD')) {
                            return truncated + '...';
                        }
                    } catch (e) {
                        // Continue to find valid boundary
                    }
                    end--;
                }
                
                return '...';
            }
        }

        // Show error message
        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.innerHTML = `<p>Error: ${message}</p>`;
            errorEl.style.display = 'block';
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('leaderboardTable').style.display = 'none';
        }

        // Load and display leaderboard
        async function loadLeaderboard() {
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.disabled = true;
            refreshBtn.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Loading...';

            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('loadingMessage').style.display = 'block';
            document.getElementById('leaderboardTable').style.display = 'none';

            try {
                // Load featured activity in parallel
                loadFeaturedActivity();

                // Calculate burn leaderboard PDA
                const [burnLeaderboardPDA] = calculatePDA(
                    [new TextEncoder().encode('burn_leaderboard')], 
                    MEMO_PROJECT_PROGRAM_ID
                );

                console.log('Burn Leaderboard PDA:', burnLeaderboardPDA.toString());

                // Get leaderboard account data
                const accountInfo = await connection.getAccountInfo(burnLeaderboardPDA);
                
                if (!accountInfo) {
                    throw new Error('Burn leaderboard not found. It may not be initialized yet.');
                }

                console.log('Leaderboard data length:', accountInfo.data.length);

                // Parse leaderboard data
                const leaderboard = parseLeaderboardData(accountInfo.data);
                console.log('Parsed leaderboard:', leaderboard);

                // Sort entries by burned amount (descending)
                const sortedEntries = leaderboard.entries.slice().sort((a, b) => {
                    if (a.burnedAmount > b.burnedAmount) return -1;
                    if (a.burnedAmount < b.burnedAmount) return 1;
                    return 0;
                });

                // Get project details for top entries
                const projectDetails = await Promise.all(
                    sortedEntries.slice(0, 100).map(async (entry) => {
                        try {
                            const projectIdBytes = new ArrayBuffer(8);
                            const view = new DataView(projectIdBytes);
                            view.setBigUint64(0, BigInt(entry.projectId), true);
                            
                            const [projectPDA] = calculatePDA(
                                [new TextEncoder().encode('project'), new Uint8Array(projectIdBytes)],
                                MEMO_PROJECT_PROGRAM_ID
                            );

                            const projectAccount = await connection.getAccountInfo(projectPDA);
                            
                            if (projectAccount) {
                                const projectData = parseProjectData(projectAccount.data);
                                return {
                                    projectId: projectData.projectId,
                                    burnedAmount: projectData.burnedAmount, // Use burned amount from project data
                                    name: projectData.name,
                                    website: projectData.website,
                                    description: projectData.description,
                                    creator: projectData.creator,
                                    createdAt: projectData.createdAt,
                                    lastUpdated: projectData.lastUpdated,
                                    image: projectData.image,
                                    tags: projectData.tags,
                                    memoCount: projectData.memoCount,
                                    lastMemoTime: projectData.lastMemoTime
                                };
                            } else {
                                return {
                                    ...entry,
                                    name: `Project ${entry.projectId}`,
                                    website: '',
                                    description: '',
                                    tags: [],
                                    memoCount: 0,
                                    lastMemoTime: 0
                                };
                            }
                        } catch (error) {
                            console.error(`Error loading project ${entry.projectId}:`, error);
                            return {
                                ...entry,
                                name: `Project ${entry.projectId}`,
                                website: '',
                                description: ''
                            };
                        }
                    })
                );

                // Render table
                renderLeaderboard(projectDetails);

                // Show empty state if no projects
                if (projectDetails.length === 0) {
                    const tbody = document.getElementById('leaderboardBody');
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 4rem 2rem; color: var(--text-secondary);">
                                <i class="fas fa-scroll" style="font-size: 48px; margin-bottom: 16px; color: var(--text-muted);"></i>
                                <p style="font-size: 16px; font-weight: 600; margin: 0 0 8px 0;">No projects found in burn leaderboard.</p>
                            </td>
                        </tr>
                    `;
                }
                
                // Hide loading and show table
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('leaderboardTable').style.display = 'block';
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                showError(`Failed to load leaderboard: ${error.message}`);
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh Data';
            }
        }

        // Render leaderboard table (updated to match reference design)
        function renderLeaderboard(projects) {
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';

            projects.forEach((project, index) => {
                const rank = index + 1;
                const row = document.createElement('tr');
                row.className = 'project-row';
                
                const burnedTokens = Number(project.burnedAmount) / 1_000_000;
                const websiteDisplay = project.website && project.website.length > 0 ? project.website : '';
                const descriptionDisplay = truncateDescription(project.description);
                const rankDisplay = getRankDisplay(rank);
                
                row.innerHTML = `
                    <td class="rank-cell">
                        ${rankDisplay.html}
                    </td>
                    <td class="id-cell">${project.projectId}</td>
                    <td class="logo-cell">
                        ${renderProjectLogo(project)}
                    </td>
                    <td class="name-cell">
                        <span class="project-name">${project.name || 'Project ' + project.projectId}</span>
                    </td>
                    <td class="website-cell">
                        ${websiteDisplay ? 
                            `<a href="${websiteDisplay}" target="_blank" rel="noopener noreferrer" class="website-link">${websiteDisplay}</a>` : 
                            '<span class="no-website">-</span>'
                        }
                    </td>
                    <td class="description-cell">
                        <span class="project-description">${descriptionDisplay}</span>
                    </td>
                    <td class="burned-cell">
                        <span class="burned-amount">
                            <i class="fas fa-fire burned-fire-icon"></i>
                            <span class="burned-number">${formatNumberWithCommas(Math.floor(burnedTokens))}</span>
                        </span>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Debug function to test pixel art decoding
        function testPixelArt() {
            console.log('PixelArt decoder ready');
            console.log('Usage: PixelArt.fromOptimalString("n:32x32:data...")');
            return PixelArt;
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            initConnection();
            loadLeaderboard();
            
            // Make PixelArt available globally for debugging
            window.PixelArt = PixelArt;
            window.testPixelArt = testPixelArt;
        });
    </script>
</body>
</html>
